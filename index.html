
<style>
	body {
		padding: 0;
		margin: 0;
	}
</style>
<canvas id=canvas></canvas>
<script>
	var viewport = document.body
	var canvas = document.getElementById('canvas')
	var context = canvas.getContext('2d')
	var canvasHeight = canvas.height = viewport.offsetHeight 
	var canvasWidth = canvas.width = viewport.offsetWidth
	var fontSize = 13
	var fontFamily = 'monospace'
	var byteBlock = fontSize/1.66640
	var lineHeight = fontSize
	var tabSize = 2

	function Buffer (size) {
		this.buff = Array(size)
		this.size = size
		this.lead = 0
		this.tail = 0
	}

	Buffer.prototype = {
		forward: forward,
		backward: backward,
		move: move,
		jump: jump,
		insert: insert,
		splice: splice,
		expand: expand,
		render: render
	}

	/**
	 * move foward
	 */
 	function forward () {
 		if (this.tail > 0)
 			this.buff[this.lead++] = this.buff[this.size-this.tail++]
 	}

 	/**
 	 * move back
 	 */
 	function backward () {
 		if (this.lead > 0)
 			this.buff[this.size-(this.tail++)-1] = this.buff[(this.lead--)-1]
 	}

 	/**
 	 * move
 	 */
 	function move (distance) {
 		var caret = distance

		while (caret--)
			distance > 0 ? this.forward() : this.backward()
 	}

 	/**
 	 * jump
 	 */
 	function jump (location) {
 		this.move(location-this.lead)
 	}

 	function insert (string) {
 		if (string.length > 0)
 			for (var i = 0; i < string.length; i++)
 				this.splice(string.charAt(i))
 		else
 			this.splice(string)
 	}

 	function splice (character) {
 		if (this.lead + this.tail === this.size)
 			this.expand()

 		this.buff[this.lead++] = character
 	}

 	function expand () {
 		var size = this.size*2
 		var buff = Array(size)

 		for (var i = 0; i < this.lead; i++)
 			buff[i] = this.buff[i]

 		for (var i = 0; i < this.tail; i++)
 			buff[size-i-1] = this.buff[this.size-i-1]

 		this.buff = buff
 		this.size = size
 	}

 	function render () {
 		clear(context, 0, 0, canvasWidth, canvasHeight)
 		draw(context, this, 0, fontSize)
 	}

 	var string = 'hello world'
 	var heap = new Buffer(string.length)

 	heap.insert(string)
 	heap.render()
 	heap.insert('.')
 	heap.render()

  /**
   * Draw
   * 
   * @param {Context} ctx
   * @param {Array<Object[]>} data
   * @param {number} xCord
   * @param {number} yCord
   */
  function draw (context, heap, xAxis, yAxis) {
  	var byte = ''
  	var buff = heap.buff

  	var lead = heap.lead|0
  	var tail = heap.tail|0
  	var length = buff.length|0
  	var size = lead|0
  	var height = lineHeight|0
  	var width = byteBlock|0
  	var tab = tabSize|0
  	var x = xAxis|0
  	var y = yAxis|0
  	var column = 0
  	var line = 0
  	var offset = 0
  	var code = 0
  	var gap = 0

  	// setup
  	context.font = fontSize+'px '+fontFamily

  	// visitor
  	while (true) {
  		if (column === size) {
				if (tail === 0 || gap++ > 0)
					break
				else
					size = length, column = tail
  		}

  		switch ((byte = buff[column++]).charCodeAt(offset = 0)) {
  			// newline
  			case 13:
  				break
  			case 10:
  				y += height
  				x = 0
  				break
  			// tab
  			case 9:
  				offset = tab*width
  			default: 
  				context.fillText(byte, x, y)
  				x += offset+width
  		}
  	}
	}

	/**
	 * Clear
	 * 
	 * @param {Context} context
	 */
	function clear (context, x, y, width, height) {
		context.clearRect(x, y, width, height)
	}

  // clear(context, 0, 0, canvasWidth, canvasHeight)
  // draw(context, heap, 0, fontSize)
 </script>
